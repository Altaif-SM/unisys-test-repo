{% extends "template_admin_applications_base.html" %}
{% load  i18n %}
{% load staticfiles %}

{% block content %}
    <div class="page-bar" style="margin-bottom: 1px;">
        <ul class="page-breadcrumb">
            <li>
                <i class="icon-home"></i>
                <a href="{% url 'tanseeq_app:tanseeq_admin' %}">Home</a>
                <i class="fa fa-angle-right"></i>
            </li>
            <li>
                <span> {% trans 'Personal Info' %} </span>
            </li>
        </ul>
    </div>

    {% for message in messages %}
        <div class="alert alert-{{ message.tags }}" role="alert" style="color: black;">{{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>
        </div>
    {% endfor %}

    <!-- BEGIN VALIDATION STATES-->
    <div class="portlet light portlet-fit portlet-form ">
        <div class="portlet-title">
            <div class="caption">
                <i class="icon-settings font-red"></i>
                <span class="caption-subject font-red sbold uppercase">Personal Info </span>
            </div>
        </div>

        <div class="portlet-body">
            <div class="form-body">
                <form
                        action="{% url 'tanseeq_app:personal_info_details' %}"
                        method="POST"
                        enctype="multipart/form-data"
                        id="id_form"
                        class="form-horizontal"
                >
                    {% csrf_token %}
                    {% if instance %}
                        <input type="hidden" name="_method" value="PATCH">
                    {% endif %}
                    <div class="form-body">
                        <div class="row item_experience" id="item_experience_1">

                            <div class="row">

                                <label class="col-md-2 control-label">{% trans form.first_name.label %}:
                                    <span style="color: red">*</span>
                                </label>
                                <div class="col-md-3">
                                    {{ form.first_name }}
                                </div>
                                <label class="col-md-2 control-label">{% trans form.last_name.label %}:
                                    <span style="color: red">*</span></label>
                                <div class="col-md-3">
                                    {{ form.last_name }}
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="">
                                    <label class="col-md-2 control-label">{% trans 'Email' %}:<span
                                            style="color: red">*</span></label>
                                    <div class="col-md-3">
                                        <input type="text" title="Enter Type" id="id_email" {% if tanseeq_application %}
                                               value="{{ tanseeq_application.user.email|default_if_none:"" }}"
                                               readonly {% else %} value="" required {% endif %}
                                               name="email"
                                               class="form-control">
                                    <span style="color: red;display: none" id="email_exists">Email already exists</span>

                                    </div>
                                </div>
                                <label class="col-md-2 control-label">{% trans form.gender_type.label %}:
                                    <span style="color: red">*</span>
                                </label>
                                <div class="col-md-3">
                                    {{ form.gender_type }}
                                </div>
                            </div>
                            <br>
                            <div class="row">

                                <label class="col-md-2 control-label">{% trans form.nationality.label %}:
                                    <span style="color: red">*</span>
                                </label>
                                <div class="col-md-3">
                                    {{ form.nationality }}
                                </div>
                                <label class="col-md-2 control-label">{% trans form.birth_date.label %}:
                                    <span style="color: red">*</span></label>
                                <div class="col-md-3">
                                    {{ form.birth_date }}
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <label class="col-md-2 control-label">Country where you born:
                                    <span style="color: red">*</span>
                                </label>
                                <div class="col-md-3">
                                    {{ form.country }}
                                </div>


                                <label class="col-md-2 control-label">{% trans 'City' %}:
                                    <span style="color: red">*</span>
                                </label>
                                <div class="col-md-3">
                                    <select id='id_city' title="Select City"
                                            name="city"
                                            class="form-control" required>
                                        {% if instance.city %}
                                            <option selected style="display: none"
                                                    value="{{ instance.city.id }}">{{ instance.city.city|default_if_none:"" }}</option>
                                        {% else %}
                                            <option value="">Please Select</option>
                                        {% endif %}
                                        {% for rec in cities %}
                                            <option value="{{ rec.id }}">{{ rec.city|default_if_none:"" }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>


                            </div>
                            <br>
                            <div class="row">
                                <label class="col-md-2 control-label">{% trans form.district.label %}:
                                    <span style="color: red">*</span>
                                </label>
                                <div class="col-md-3">
                                    {{ form.district }}
                                </div>

                                <label class="col-md-2 control-label">{% trans form.contact_number.label %}:
                                    <span style="color: red">*</span>
                                </label>
                                <div class="col-md-3">
                                    {{ form.contact_number }}
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <label class="col-md-2 control-label">{% trans form.address.label %}:
                                    <span style="color: red">*</span>
                                </label>
                                <div class="col-md-8">
                                    {{ form.address }}
                                </div>
                            </div>
                            <br>
                        </div>
                        <div class="row">
                            <div class="col-md-offset-10 col-md-7">

                                {% if instance == None %}
                                    <button type="submit" class="btn green" id="save_form">Save Next</button>
                                {% else %}
                                    {% if  instance.application_status == 'Not Submitted' %}
                                        <button type="submit" class="btn green" id="save_form">Save Next</button>

                                    {% else %}
                                        <button type="button"
                                                onClick="location.href='{% url 'tanseeq_app:add_secondary_certificate_info' %}'"
                                                class="btn green" id="next" style="float: left">Next
                                        </button>
                                    {% endif %}
                                {% endif %}


                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}
{% block ajax %}
    <script>

        $(document).on("change", "#id_email", function (e) {
            var email = $(this).val();
            var user_id = $('#user_id').val()
            var url = '/accounts/get_email_exists/';
            get_email_exists_fun(url, email, user_id)
        })


        {% if tanseeq_application.application_status == 'Submitted' %}
            $('input').prop('disabled', 'true');
            $('textarea').prop('disabled', 'true');
            $('select').prop('disabled', 'true');
            $('label').prop('readonly', 'true');
        {% endif %}

        const getCityDataUrl = "{% url 'tanseeq_app:list_tanseeq_city' %}"

        $(document).ready(function () {
            $("#id_country").on("change", function () {
                getCityData(getCityDataUrl)
            })
        });

        function get_email_exists_fun(url, email,user_id) {
            $.ajax({
                type: 'POST',
                url: url,
                data: {
                    user_id: user_id,
                    email: email,
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                },
                success: function (data) {
                    var email_exists = data;
                    if(email_exists === true){
                        $('#id_email').val('');
                        $('#email_exists').show();
                    }
                    else{
                        $('#email_exists').hide();
                    }


                },
                error: function (xhr, msg, err) {
                    alert(xhr.responseJSON.error);
                }
            });
        }
    </script>
    <script src="{% static 'tanseeq\student\StudentApplications.js' %}" type="text/javascript"></script>
{% endblock %}


